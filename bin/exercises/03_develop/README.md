# Exercise 03: Developing the application.

## Estimated time

:clock4: 20 minutes

## Objective

In this exercise you'll learn how you can develop the sample Product List application.

# Exercise description

## Create a Spring Boot Starter Project

- Eclipse -> File -> New -> Project -> Spring Boot -> Spring Starter Project
- Click **Next** button
- On the next page fill in a name for the project e.g. my-product-list and click **Next** button
- Now you have to choose some Project Dependencies. In the search field type each dependency and select the check box in front of it to include it in the list of selected dependencies for the project: Actuator (Ops group), H2 (SQL group), JPA (SQL group), DevTools (Core group). You selected dependencies list should look like the screenshot below. Click **Finish** button and wait a minute until the project is created.
- You should now see it in the Project Explorer.
- Build the project - right click in Project Explorer and select Run As -> Maven Build and enter Goal *clean install*.
- //TODO - Check it's running locally? You can already see the newly created SpringBoot application running locally. Right click on the project in Project Explorer and select Run as -> SpringBoot App

Now we can continue with the application development steps.

## Product
- Create **class Product**
- Annotate the class with ```@Entity``` (Organize imports -> javax.persistence.Entity) to indicate that this is a JPA Entity.  For lack of a @Table annotation, it is assumed that this entity will be mapped to a table named Product.
- Add the following **list of fields** for the Product. Annotate the id field with ```@Id and @GeneratedValue```
@Id specifies the primary key so that JPA will recognize it as the object’s id. The id property is also annotated with @GeneratedValue to indicate that the id (primary key) should be generated automatically. The other properties are left unannotated. It is assumed that they’ll be mapped to columns that share the same name as the properties themselves.

```java
    @Id
	@GeneratedValue
    private Long id;
	private String name;
	private String description;
	private BigDecimal price;
	private String currencyCode;
	private String pictureUrl;
```

//TODO - what's the nice feature coming with STS Kay mentioned for code generation instead of right click -> Source

- Generate **Getter and Setter methods** for all fields, except setter for id as it will be autogenerated. Source -> Generate Getters and Setters
- Generate **constructors** - using all Product fields (except Id), using only name field omitting and the call to default constructor super(), and a default constructor without fields. Right click on the Product class in Project Explorer then Source -> Generate Constructor using Fields...
- **Override toString method** for convenient printing of the Product properties.

```java
@Override
	public String toString() {
		return "Product [id=" + id + ", name=" + name + ", description=" + description + ", price=" + price
				+ ", currencyCode=" + currencyCode + ", pictureUrl=" + pictureUrl + "]";
	}

```
We are done with the Product Entity and can continue with Product Repository.

## Product Repository
- Create an **interface ProductRepository** that **extends org.springframework.data.jpa.repository.JpaRepository** and works with Product entities **<Product, String>**. This interface helps us work with the Product entities. By extending JpaRepository, ProductRepository inherits several methods for working with Product persistence, including methods for saving, deleting, and finding Product entities. Spring Data JPA also allows you to define other query methods by simply declaring their method signature. In the case of ProductRepository, this can be done with a findByName() method:
```java
public Collection<Product> findByName(String name);
```
- Navigate to the application pom.xml file and add the following dependency
```Config
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-rest</artifactId>
</dependency>
```
- Annotate with ```@RepositoryRestResource```. This indicates that at runtime, Spring Data REST will create an implementation of this interface automatically. Then it will use the @RepositoryRestResource annotation to direct Spring MVC to create RESTful endpoints.
- Initialize the database using Hibernate. Navigate to src/main/resources/application.properties file and add:
```Config
spring.jpa.hibernate.ddl-auto=create-drop
```
This means drop the old schema and create a new one. Of course, this is valid approach for development only, for productive usage you should integrate some schema management tool like e.g. Liquibase)

## Initialize with data
Now we need to initialize with some sample data, persist it and print it. We will do it adding the following code snippet to your SpringBoot Application class. Navigate to the SpringBootApplication class that was generated once you created the Spring Starter Project and add the snippet:

```java
@Bean
	CommandLineRunner runner(final ProductRepository productRepo) {
		return strings -> {

			final List<Product> products = Arrays.asList(
					new Product("Notebook Basic 15",
							"Notebook Basic 15 with 1,7GHz - 15\" XGA - 1024MB DDR2 SDRAM - 40GB Hard Disc", "956.00",
							"EUR", "images/HT-1000.jpg"),
					new Product("Notebook Professional 15",
							"Notebook Professional 15 with 2,3GHz - 15\" XGA - 2048MB DDR2 SDRAM - 40GB Hard Disc - DVD-Writer (DVD-R/+R/-RW/-RAM)",
							"1999.00", "EUR", "images/HT-1010.jpg"),
					new Product("Ergo Screen",
							"17\" Optimum Resolution 1024 x 768 @ 85Hz, Max resolution 1280 x 960 @ 75Hz, Dot Pitch: 0.27mm",
							"230.00", "EUR", "images/HT-1030.jpg"));

			productRepo.save(products);

			productRepo.findAll().forEach(System.out::println);
		};
	}
```
Then the main() method of our application class uses Spring Boot’s SpringApplication.run() method to launch an application. It fetches the ProductRepository from the Spring application context. Then it saves a handful of Product objects, demonstrating the save() method and setting up some data to work with. Next, it calls findAll() to fetch all Customer objects from the database and prints them.

## Create Controller
In Spring’s approach to building RESTful web services, HTTP requests are handled by a controller. These components are easily identified by the @RestController annotation.
- Create new **class Controller**
- Add annotation @RestController and include the following code snippet replacing class names where applicable:
```java
	@Autowired
	private ProductRepository productRepo;

	@GetMapping("/productsByParam")
	public Collection<Product> getProductByName(@RequestParam(value = "name") final String name) {
		return productRepo.findByName(name);
	}
```
- The controller receives requests from client, using repository to get data and return results.
The controller handles GET requests for /productsByParam by returning a collection of products based on name parameter.

## Create an UI
Let's add basic UI to our application using SAPUI5. The index.html we need is rather simple, but for the sake of time saving we won't ask you to implement it.
- Navigate to src/main/resources in the target application you cloned from github and copy the static folder where we have index.html and some images. Then paste it in your application project under src/main/resources.

## Build the project and run locally
- Right click on the project -> Run as -> Maven build
- Once the build is finished run locally the application: Right click on the project -> Run as -> Spring Boot App

//TODO explain how to run on different port if 8080 is occupied by another process

Now you can open a browser and see the application running on http://localhost:8080/
You should see a list of 3 products and when you click on a product get a dedicated product view with product description.
